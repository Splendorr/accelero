/*
 * Accelero
 * https://github.com/manifestinteractive/accelero
 * Copyright (c) 2013 Peter Schmalfeldt <me@peterschmalfeldt.com>
 * Updates: http://twitter.com/mrmidi
 * Licensed under the MIT, GPL licenses.
 */

(function(c,d,m,n){function l(b,a){this.element=b;this.$element=c(b);var e={},k=this.$element.data(),f;for(f in k)if(g.hasOwnProperty(f)&&typeof("string"===g[f])||typeof("number"===g[f])||typeof("boolean"===g[f]))e[f]=k[f];this.options=c.extend({},g,e,a);this._defaults=g;this._name=h;this._accelero={};this._motion={};this._supported={motion:"undefined"!==typeof d.DeviceMotionEvent,orientation:"undefined"!==typeof d.DeviceOrientationEvent,touch:"ontouchstart"in d||"undefined"!==typeof navigator.msMaxTouchPoints,
mouse:"onmousemove"in d};this.init()}var h="accelero",g={controlMethod:"auto",enableMove:!0,enableRotate:!0,invertLayerStack:!1,invertMoveX:!1,invertMoveY:!1,invertRotateX:!1,invertRotateY:!1,maxAngle:3,speed:0.2};l.prototype={init:function(){var b=this;d.requestAnimFrame=function(){return d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||function(a){d.setTimeout(a,1E3/60)}}();this._accelero.layers=this.options.invertLayerStack?c("> div:not(.ignore)",this.$element):
c(c("> div:not(.ignore)",this.$element).get().reverse());this._accelero.layerCount=c("> div:not(.ignore)",this.$element).length;c(this.$element).data("layer-count",this._accelero.layerCount);this.resize();!this._supported.orientation||"auto"!=this.options.controlMethod&&"orientation"!=this.options.controlMethod?!this._supported.touch&&!this._supported.mouse||"auto"!=this.options.controlMethod&&"touch"!=this.options.controlMethod||(c(this.$element).mousemove(function(a){c.proxy(b.move(a),b)}),this.element.addEventListener("touchmove",
function(a){c.proxy(b.move(a),b);a.preventDefault()})):d.addEventListener("deviceorientation",function(a){b._motion.ax=5*a.gamma;b._motion.ay=7*a.beta;d.requestAnimFrame(function(a){b.move(a)})},!1);c(d).resize(function(){c.proxy(b.resize(),b)});d.onorientationchange=function(){c.proxy(b.resize(),b)}},resize:function(){var b=this;b._accelero.centerX=b.$element.width()/2;b._accelero.centerY=b.$element.height()/2;b._accelero.layers.each(function(a,e){var d=a+1,f=(c(e).width()-b.$element.width())/2,
g=(c(e).height()-b.$element.height())/2;c(e).css({"z-index":d,left:-f+"px",top:-g+"px"}).data("layer",d)})},track:function(b,a,e){var k=!1,f=!1;if("undefined"!==typeof d.orientation){if(90===d.orientation||-90===d.orientation)k=!0;-90===d.orientation&&(f=!0)}!this._supported.orientation||"auto"!=this.options.controlMethod&&"orientation"!=this.options.controlMethod?!this._supported.touch&&!this._supported.mouse||"auto"!=this.options.controlMethod&&"touch"!=this.options.controlMethod||("undefined"==
typeof this._accelero.currentX&&(this._accelero.currentX=b.pageX),"undefined"==typeof this._accelero.currentY&&(this._accelero.currentY=b.pageY),this._accelero.xdiff=b.pageX-this._accelero.currentX,this._accelero.ydiff=b.pageY-this._accelero.currentY,this._accelero.currentX=b.pageX,this._accelero.currentY=b.pageY,this._accelero.px=this._accelero.xdiff*this.options.speed*(a+1),this._accelero.py=this._accelero.ydiff*this.options.speed*(a+1),this._accelero.newX=c(e).position().left+this._accelero.px,
this._accelero.newY=c(e).position().top+this._accelero.py,this._accelero.centerOffsetX=b.pageX-(this.$element.offset().left+this.$element.width()/2),this._accelero.centerOffsetY=b.pageY-(this.$element.offset().top+this.$element.height()/2),c(this.$element).data("current-x",this._accelero.currentX),c(this.$element).data("current-y",this._accelero.currentY),c(this.$element).data("x-diff",this._accelero.xdiff),c(this.$element).data("y-diff",this._accelero.ydiff)):k?(this._accelero.centerOffsetX=this._motion.ay,
this._accelero.centerOffsetY=f?-this._motion.ax:this._motion.ax):(this._accelero.centerOffsetX=this._motion.ax,this._accelero.centerOffsetY=f?-this._motion.ay:this._motion.ay)},move:function(b){var a=this;a._accelero.layers.each(function(e,d){a.track(b,e,d);a._accelero.rotateX=a.options.invertRotateX?0<a._accelero.centerOffsetX?a._accelero.centerOffsetX/a._accelero.centerX*-(a.options.maxAngle*(e+1)):a.options.maxAngle*(e+1)*(Math.abs(a._accelero.centerOffsetX)/a._accelero.centerX):0<a._accelero.centerOffsetX?
a._accelero.centerOffsetX/a._accelero.centerX*(e+1)*a.options.maxAngle:-(a.options.maxAngle*(e+1))*(Math.abs(a._accelero.centerOffsetX)/a._accelero.centerX);a._accelero.rotateY=a.options.invertRotateY?0<a._accelero.centerOffsetY?a._accelero.centerOffsetY/a._accelero.centerY*(e+1)*a.options.maxAngle:-(a.options.maxAngle*(e+1))*(Math.abs(a._accelero.centerOffsetY)/a._accelero.centerY):0<a._accelero.centerOffsetY?a._accelero.centerOffsetY/a._accelero.centerY*-(a.options.maxAngle*(e+1)):a.options.maxAngle*
(e+1)*(Math.abs(a._accelero.centerOffsetY)/a._accelero.centerY);a._accelero.translateX=a.options.invertMoveX?-(a._accelero.centerOffsetX/(a._accelero.layerCount-e)*a.options.speed):a._accelero.centerOffsetX/(a._accelero.layerCount-e)*a.options.speed;a._accelero.translateY=a.options.invertMoveY?-(a._accelero.centerOffsetY/(a._accelero.layerCount-e)*a.options.speed):a._accelero.centerOffsetY/(a._accelero.layerCount-e)*a.options.speed;switch(!0){case a.options.enableMove&&a.options.enableRotate:a._accelero.transform=
{"transform-origin":"50% 50%",transform:"perspective( 600px ) rotateX("+a._accelero.rotateY+"deg) rotateY("+a._accelero.rotateX+"deg) translateX("+a._accelero.translateX+"px) translateY("+a._accelero.translateY+"px)","z-index":10*(e+1)};break;case a.options.enableMove:a._accelero.transform={transform:"translateX("+a._accelero.translateX+"px) translateY("+a._accelero.translateY+"px)","z-index":10*(e+1)};break;case a.options.enableRotate:a._accelero.transform={"transform-origin":"50% 50%",transform:"perspective( 600px ) rotateX("+
a._accelero.rotateY+"deg) rotateY("+a._accelero.rotateX+"deg)","z-index":10*(e+1)};break;default:a._accelero.transform={"z-index":10*(e+1)}}c(d).data("layer",10*(e+1));c(d).data("rotate-x",a._accelero.rotateX);c(d).data("rotate-y",a._accelero.rotateY);c(d).data("translate-x",a._accelero.translateX);c(d).data("translate-y",a._accelero.translateY);c(d).css(a._accelero.transform)})}};c.fn[h]=function(b){return this.each(function(){c.data(this,"plugin_"+h)||c.data(this,"plugin_"+h,new l(this,b))})};c(function(){c("."+
h)[h]()})})(jQuery,window,document);
